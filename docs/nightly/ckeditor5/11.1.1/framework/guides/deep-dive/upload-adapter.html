<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Custom image upload adapter - CKEditor 5 Documentation</title>
    <meta name="description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta name="twitter:card" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta name="twitter:site" content="@ckeditor">
    <meta property="og:title" content="Custom image upload adapter - CKEditor 5 Documentation">
    <meta property="og:description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <meta property="DC.language" content="en">
    <meta property="DC.publisher" content="CKSource">
    <meta property="DC.creator" content="CKEditor">
    <meta property="DC.title" content="Custom image upload adapter - CKEditor 5 Documentation">
    <meta property="DC.format" content="text/html">
    <meta property="DC.type" content="Text">
    <meta property="DC.description" content="Learn how to install, integrate and configure CKEditor 5 Builds and how to work with CKEditor 5 Framework, customize it, create your own plugins and custom editors, change the UI or even bring your own UI to the editor. API reference and examples included.">
    <link rel="canonical" href="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/deep-dive/upload-adapter.html">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../assets/img/favicons/96x96.png" sizes="96x96">
    <link rel="apple-touch-icon" type="image/png" href="../../../assets/img/favicons/200x200.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
    <link rel="stylesheet" href="../../../../../assets/0.12.1/css/styles.css" type="text/css" media="screen">
    <link rel="stylesheet" href="../../../assets/styles.css" type="text/css">
    <script>
      ( function() {
      	'use strict';
      	// Set up global variables;
      	if ( !window.umebrto ) {
      		window.umberto = {};
      	}
      	window.umberto.relativeAppPath = "../../../../../assets/0.12.1/scripts"
      
      	// Add app script
      	var el = document.createElement( 'script' );
      	el.setAttribute( 'async', 'async' );
      	el.setAttribute( 'defer', 'defer' );
      	if ( typeof Symbol === 'function' && typeof Symbol() === 'symbol' ) {
      		el.src = "../../../../../assets/0.12.1/scripts/app.js";
      	} else {
      		el.src = "../../../../../assets/0.12.1/scripts/app-polyfill.js";
      	}
      	document.getElementsByTagName( 'head' )[ 0 ].appendChild( el );
      } )();
    </script>
    <script>if ( ["ckeditor5.github.io"].indexOf( location.hostname ) !== -1 ) {
      	function pageView() {
      		ga( 'send', 'pageview', location.pathname + location.search + location.hash );
      	}
      
      	(function( i, s, o, g, r, a, m ) {
      		i[ 'GoogleAnalyticsObject' ] = r;
      		i[ r ] = i[ r ] || function() {
      				(i[ r ].q = i[ r ].q || []).push( arguments )
      			}, i[ r ].l = 1 * new Date();
      		a = s.createElement( o ),
      			m = s.getElementsByTagName( o )[ 0 ];
      		a.async = 1;
      		a.src = g;
      		m.parentNode.insertBefore( a, m )
      	})( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' );
      
      	ga( 'create', {"trackingId":"UA-271067-19","cookieDomain":"ckeditor5.github.io"} );
      
      	pageView();
      
      	window.addEventListener( 'hashchange', pageView );
      }
    </script>
  </head>
  <body>
    <header class="top" data-project="ckeditor5">
      <div class="header__main">
        <div class="header__main-rwd-button"><a href="#"><span></span><span></span><span></span></a></div>
        <div class="header__main-title"><a class="header__main-title-home" href="../../../../../index.html">CKEditor Ecosystem Documentation</a></div>
        <div class="top__search">
          <input class="top__search__box" type="text" id="docsearch_input" placeholder="Search in CKEditor 5">
          <div class="top__search__button"><img src="../../../../../assets/0.12.1/img/loupe.svg" alt="Search"></div>
        </div>
      </div>
      <div class="header__sub">
        <ul class="top__menu">
          <li class="top__menu-project-logo"><a href="../../../index.html">CKEditor 5</a></li>
          <li><a href="../../../builds/index.html">Builds</a></li>
          <li><a class="top__menu__item--active" href="../../index.html">Framework</a></li>
          <li><a href="../../../examples/index.html">Examples</a></li>
          <li><a href="../../../features/index.html">Features</a></li>
          <li><a class="top__menu__api" href="../../../api/index.html">API</a></li>
          <li><a class="top__menu-github-link" href="https://github.com/ckeditor/ckeditor5" target="_blank" title="CKEditor 5 on GitHub."><svg viewbox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></li>
        </ul>
      </div>
      <div class="header__menu-rwd">
        <ul class="header__menu-rwd__projects">
          <li data-project="ckeditor5"><a href="../../../../latest/index.html">CKEditor 5
              <ul class="tree header__menu-rwd__projects-pages">
                <li data-group="builds"><a href="../../../builds/index.html">Builds</a>
                  <!-- Display subpages for active project.-->
                </li>
                <li data-group="framework"><a href="../../index.html">Framework</a>
                  <!-- Display subpages for active project.-->
                  <ul class="header__menu-rwd__projects-subpages">
                            <li>
                              <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Guides</span></div>
                              <ul class="tree__item-nested-list">
                                    <li><a href="../overview.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Overview</span></div></a></li>
                                    <li><a href="../quick-start.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Quick start</span></div></a></li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Architecture</span></div>
                                      <ul class="tree__item-nested-list">
                                            <li><a href="../architecture/intro.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span></div></a></li>
                                            <li><a href="../architecture/core-editor-architecture.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Core editor architecture</span></div></a></li>
                                            <li><a href="../architecture/editing-engine.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Editing engine</span></div></a></li>
                                            <li><a href="../architecture/ui-library.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">UI library</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Deep dive</span></div>
                                      <ul class="tree__item-nested-list">
                                            <li><a href="clipboard.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Clipboard</span></div></a></li>
                                            <li><a href="">
                                                <div class="tree__item__wrapper tree__item__wrapper--active"><span class="tree__item--guide tree__item__text">Custom upload adapter</span></div></a></li>
                                            <li><a href="observables.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Observables</span></div></a></li>
                                            <li><a href="schema.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Schema</span></div></a></li>
                                            <li>
                                              <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">User interface</span></div>
                                              <ul class="tree__item-nested-list">
                                                    <li><a href="ui/theme-customization.html">
                                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Theme customization</span></div></a></li>
                                                    <li><a href="ui/external-ui.html">
                                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Third–party UI</span></div></a></li>
                                                    <li><a href="ui/document-editor.html">
                                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Document editor</span></div></a></li>
                                              </ul>
                                            </li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Contributing</span></div>
                                      <ul class="tree__item-nested-list">
                                            <li><a href="../contributing/contributing.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Contributing</span></div></a></li>
                                            <li><a href="../contributing/development-environment.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development environment</span></div></a></li>
                                            <li><a href="../contributing/testing-environment.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Testing environment</span></div></a></li>
                                            <li><a href="../contributing/git-commit-message-convention.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Git commit message convention</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Support</span></div>
                                      <ul class="tree__item-nested-list">
                                            <li><a href="../support/browser-compatibility.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Browser compatibility</span></div></a></li>
                                            <li><a href="../support/license-and-legal.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">License and legal</span></div></a></li>
                                            <li><a href="../support/getting-support.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Getting support</span></div></a></li>
                                            <li><a href="../support/reporting-issues.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Reporting issues</span></div></a></li>
                                            <li><a href="../support/error-codes.html">
                                                <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Error codes</span></div></a></li>
                                      </ul>
                                    </li>
                              </ul>
                            </li>
                  </ul>
                </li>
                <li data-group="examples"><a href="../../../examples/index.html">Examples</a>
                  <!-- Display subpages for active project.-->
                </li>
                <li data-group="features"><a href="../../../features/index.html">Features</a>
                  <!-- Display subpages for active project.-->
                </li>
                <li data-group="api-reference"><a href="../../../api/index.html">API</a>
                  <!-- Display subpages for active project.-->
                </li>
              </ul></a></li>
        </ul>
      </div>
    </header>
    <main class="main">
      <section class="main__content formatted">
        <div class="main__content-inner">
          <div class="github-contrib"><a href="https://github.com/ckeditor/ckeditor5-image/blob/master/docs/framework/guides/deep-dive/upload-adapter.md" title="Contribute to this guide"><img src="../../../../../assets/0.12.1/img/edit.svg" alt="Contribute to this guide"></a><a href="https://github.com/ckeditor/ckeditor5-image/issues/new" title="Report an issue"><img src="../../../../../assets/0.12.1/img/exclamation-circle.svg" alt="Report an issue"></a>
          </div>
          <div class="rwd-breadcrumbs"><a href="../../../../../index.html">Home</a><span class="rwd-breadcrumbs__separator">/</span><a href="../../../index.html">CKEditor 5</a><span class="rwd-breadcrumbs__separator">/</span><a href="../../index.html">Framework</a>
          </div>
          <h1 class="main__content-title"><img src="../../../../../assets/0.12.1/img/book.svg" alt="guide">Custom image upload adapter
          </h1><nav class="secondary-navigation"><h3>Table of contents</h3><ol><li><a href="#how-does-the-image-upload-work">How does the image upload work?</a></li><li><a href="#implementing-a-custom-upload-adapter">Implementing a custom upload adapter</a><ol><li><a href="#the-anatomy-of-the-adapter">The anatomy of the adapter</a></li><li><a href="#using-xmlhttprequest-in-an-adapter">Using XMLHttpRequest in an adapter</a></li><li><a href="#activating-a-custom-upload-adapter">Activating a custom upload adapter</a></li></ol></li><li><a href="#whats-next">What&#x2019;s next?</a></li></ol></nav>
<div class="info-box notice"><p>Check out the <a href="../../../features/image-upload.html">comprehensive &#x201C;Image upload&#x201D; guide</a> to learn about other ways to upload images into CKEditor 5.</p></div>
<h2 id="how-does-the-image-upload-work"><a class="headerlink" href="#how-does-the-image-upload-work">#</a> How does the image upload work?</h2>
<p>Before you can implement your own custom upload adapter, you should learn a little bit about the image upload process in CKEditor 5. The whole process boils down to the following steps:</p>
<ol>
<li>
<p>First, an image (or images) need to get into the editor content. There are many ways to do that, for instance:</p>
<ul>
<li>pasting from the clipboard,</li>
<li>dragging a file from the file system,</li>
<li>selecting and image through a file system dialog.</li>
</ul>
<p>The images are intercepted by the <a href="../../../api/module_image_imageupload-ImageUpload.html">image upload</a> plugin (which is enabled in all <a href="../../../builds/guides/overview.html">editor builds</a>).</p>
</li>
<li>
<p>For every image, the image upload plugin <a href="../../../api/module_upload_filerepository-FileRepository.html#function-createLoader">creates an instance of a file loader</a>.</p>
<ul>
<li>The role of the <strong>file loader</strong> is to read the file from the disk and upload it to the server by using the upload adapter.</li>
<li>The role of the <strong>upload adapter</strong> is, therefore, to securely send the file to the server and pass the response from the server (e.g. the URL to the saved file) back to the file loader (or handle an error, if there was one).</li>
</ul>
</li>
<li>
<p>While the images are being uploaded, the image upload plugin</p>
<ul>
<li>creates placeholders of those images,</li>
<li>inserts them into the editor,</li>
<li>displays the progress bar on each of them,</li>
<li>when an image is deleted from the editor content before upload finishes, aborts the upload process.</li>
</ul>
</li>
<li>
<p>Once the file is uploaded, the upload adapter notifies the editor about this fact by resolving its <code>Promise</code>. It passes the URL (or URLs in case of responsive images) to the image upload plugin which replaces <code>src</code> and <code>srcset</code> attributes of the image placeholder in the editor content.</p>
</li>
</ol>
<p>This is just an overview of the image upload process. The truth is, the whole thing is more complicated. For instance, images can be copied and pasted within the editor (while the upload takes place) and all potential upload errors must be handled too. The good news is those tasks are handled transparently by the <a href="../../../api/module_image_imageupload-ImageUpload.html">image upload</a> plugin so you do not have to worry about them.</p>
<p>To sum up, for the image upload to work in the editor, two conditions must be true:</p>
<ul>
<li>
<p><strong>The <a href="../../../api/module_image_imageupload-ImageUpload.html">image upload</a> plugin must be enabled</strong> in the editor. It is enabled in all <a href="../../../builds/guides/overview.html">builds</a> by default, but if you are <a href="../../../builds/guides/development/custom-builds.html">customizing</a> an editor, do not forget to include it.</p>
</li>
<li>
<p><strong>The upload adapter needs to be defined</strong>. This can be done by using (enabling <em>and</em> configuring)</p>
<ul>
<li><a href="../../../features/image-upload.html#official-upload-adapters">one of the existing upload adapters</a>,</li>
<li><a href="#implementing-a-custom-upload-adapter">your custom upload adapter</a> and handling uploaded files on your server back&#x2013;end.</li>
</ul>
</li>
</ul>
<h2 id="implementing-a-custom-upload-adapter"><a class="headerlink" href="#implementing-a-custom-upload-adapter">#</a> Implementing a custom upload adapter</h2>
<p>In this guide we are going to implement and enable a custom upload adapter that will allow you to take the <strong>full control</strong> over the process of sending the files to the server as well as passing the response from the server (e.g. the URL to the saved file) back to the editor.</p>
<h3 id="the-anatomy-of-the-adapter"><a class="headerlink" href="#the-anatomy-of-the-adapter">#</a> The anatomy of the adapter</h3>
<p>Let&#x2019;s define the <code>MyUploadAdapter</code> class and fill its internals step&#x2013;by&#x2013;step. The adapter will use the native <code>XMLHttpRequest</code> to send files returned by the loader to a pre&#x2013;configured URL on a server, handling <code>error</code>, <code>abort</code>, <code>load</code>, and <code>progress</code> events fired by the request.</p>
<pre class="highlight"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUploadAdapter</span> </span>{
    <span class="hljs-keyword">constructor</span>( loader, url ) {
        <span class="hljs-comment">// The FileLoader instance to use during the upload. It sounds scary but do not</span>
        <span class="hljs-comment">// worry &#x2014; the loader will be passed into the adapter later on in this guide.</span>
        <span class="hljs-keyword">this</span>.loader = loader;

        <span class="hljs-comment">// The upload URL in your server back-end. This is the address the XMLHttpRequest</span>
        <span class="hljs-comment">// will send the image data to.</span>
        <span class="hljs-keyword">this</span>.url = url;
    }

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Your custom upload adapter must implement the <a href="../../../api/module_upload_filerepository-UploadAdapter.html"><code>UploadAdapter</code> interface</a> in order to work, i.e. bring own <code>upload()</code> and <code>abort()</code> methods.</p>
<ul>
<li>The <a href="../../../api/module_upload_filerepository-UploadAdapter.html#function-upload"><code>upload()</code></a> method must return a promise:
<ul>
<li>resolved by a successful image upload (with an object containing information about uploaded file),</li>
<li>rejected because of an error, in which case no image is inserted into the content.</li>
</ul>
</li>
<li>The <a href="../../../api/module_upload_filerepository-UploadAdapter.html#function-abort"><code>abort()</code></a> must allow the editor to abort the upload process. It is necessary, for instance, when the image was removed from the content by the user before the upload finished.</li>
</ul>
<pre class="highlight"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUploadAdapter</span> </span>{
    <span class="hljs-keyword">constructor</span>( loader, url ) {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// Starts the upload process.</span>
    upload() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>( <span class="hljs-function">(<span class="hljs-params"> resolve, reject </span>) =&gt;</span> {
            <span class="hljs-keyword">this</span>._initRequest();
            <span class="hljs-keyword">this</span>._initListeners( resolve, reject );
            <span class="hljs-keyword">this</span>._sendRequest();
        } );
    }

    <span class="hljs-comment">// Aborts the upload process.</span>
    abort() {
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.xhr ) {
            <span class="hljs-keyword">this</span>.xhr.abort();
        }
    }

    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 id="using-xmlhttprequest-in-an-adapter"><a class="headerlink" href="#using-xmlhttprequest-in-an-adapter">#</a> Using <code>XMLHttpRequest</code> in an adapter</h3>
<p>Let&#x2019;s see what the <code>_initRequest()</code> method looks like in your custom upload adapter. It should prepare the <code>XMLHttpRequest</code> object before it can be used to upload an image.</p>
<pre class="highlight"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUploadAdapter</span> </span>{
    <span class="hljs-keyword">constructor</span>( loader, url ) {
        <span class="hljs-comment">// ...</span>
    }

    upload() {
        <span class="hljs-comment">// ...</span>
    }

    abort() {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// Initializes the XMLHttpRequest object using the URL passed to the constructor.</span>
    _initRequest() {
        <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">this</span>.xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();

        <span class="hljs-comment">// Note that you request may look different. It is up to you and you editor</span>
        <span class="hljs-comment">// integration to choose the right communication channel. This example uses</span>
        <span class="hljs-comment">// the POST request with a JSON as a data structure but your configuration</span>
        <span class="hljs-comment">// could be different.</span>
        xhr.open( <span class="hljs-string">&apos;POST&apos;</span>, <span class="hljs-keyword">this</span>.url, <span class="hljs-literal">true</span> );
        xhr.responseType = <span class="hljs-string">&apos;json&apos;</span>;
    }
}
</code></pre>
<p>Now let&#x2019;s focus on the <code>_initListeners()</code> method which attaches <code>error</code>, <code>abort</code>, <code>load</code>, and <code>progress</code> event listeners to the <code>XMLHttpRequest</code> object created in the last step.</p>
<p>A successful image upload will finish when the upload promise is resolved upon the <code>load</code> event fired by the <code>XMLHttpRequest</code> request. The promise must be resolved with an object containing information about the image. See the documentation of the <a href="../../../api/module_upload_filerepository-UploadAdapter.html#function-upload"><code>upload()</code></a> method to learn more.</p>
<pre class="highlight"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUploadAdapter</span> </span>{
    <span class="hljs-keyword">constructor</span>( loader, url ) {
        <span class="hljs-comment">// ...</span>
    }

    upload() {
        <span class="hljs-comment">// ...</span>
    }

    abort() {
        <span class="hljs-comment">// ...</span>
    }

    _initRequest() {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// Initializes XMLHttpRequest listeners.</span>
    _initListeners( resolve, reject ) {
        <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">this</span>.xhr;
        <span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">this</span>.loader;
        <span class="hljs-keyword">const</span> genericErrorText = <span class="hljs-string">&apos;Couldn\&apos;t upload file:&apos;</span> + <span class="hljs-string">` <span class="hljs-subst">${ loader.file.name }</span>.`</span>;

        xhr.addEventListener( <span class="hljs-string">&apos;error&apos;</span>, () =&gt; reject( genericErrorText ) );
        xhr.addEventListener( <span class="hljs-string">&apos;abort&apos;</span>, () =&gt; reject() );
        xhr.addEventListener( <span class="hljs-string">&apos;load&apos;</span>, () =&gt; {
            <span class="hljs-keyword">const</span> response = xhr.response;

            <span class="hljs-comment">// This example assumes the XHR server&apos;s &quot;response&quot; object will come with</span>
            <span class="hljs-comment">// an &quot;error&quot; which has its own &quot;message&quot; that can be passed to reject()</span>
            <span class="hljs-comment">// in the upload promise.</span>
            <span class="hljs-comment">//</span>
            <span class="hljs-comment">// Your integration may handle upload errors in a different way so make sure</span>
            <span class="hljs-comment">// it is done properly. The reject() function must be called when the upload fails.</span>
            <span class="hljs-keyword">if</span> ( !response || response.error ) {
                <span class="hljs-keyword">return</span> reject( response &amp;&amp; response.error ? response.error.message : genericErrorText );
            }

            <span class="hljs-comment">// If the upload is successful, resolve the upload promise with an object containing</span>
            <span class="hljs-comment">// at least the &quot;default&quot; URL, pointing to the image on the server.</span>
            <span class="hljs-comment">// This URL will be used to display the image in the content. Learn more in the</span>
            <span class="hljs-comment">// UploadAdapter#upload documentation.</span>
            resolve( {
                <span class="hljs-attr">default</span>: response.url
            } );
        } );

        <span class="hljs-comment">// Upload progress when it&apos;s supported. The FileLoader has the #uploadTotal and #uploaded</span>
        <span class="hljs-comment">// properties which are used e.g. to display the upload progress bar in the editor</span>
        <span class="hljs-comment">// user interface.</span>
        <span class="hljs-keyword">if</span> ( xhr.upload ) {
            xhr.upload.addEventListener( <span class="hljs-string">&apos;progress&apos;</span>, evt =&gt; {
                <span class="hljs-keyword">if</span> ( evt.lengthComputable ) {
                    loader.uploadTotal = evt.total;
                    loader.uploaded = evt.loaded;
                }
            } );
        }
    }
}
</code></pre>
<p>Last but not least, the <code>_sendRequest()</code> method well&#x2026; sends the <code>XMLHttpRequest</code>. In this example, the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" target="_blank" rel="noopener"><code>FormData</code></a> interface is used to pass the file provided by the <a href="../../../api/module_upload_filerepository-FileRepository.html#function-createLoader">file loader</a>.</p>
<pre class="highlight"><code class="js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUploadAdapter</span> </span>{
    <span class="hljs-keyword">constructor</span>( loader, url ) {
        <span class="hljs-comment">// ...</span>
    }

    upload() {
        <span class="hljs-comment">// ...</span>
    }

    abort() {
        <span class="hljs-comment">// ...</span>
    }

    _initRequest() {
        <span class="hljs-comment">// ...</span>
    }

    _initListeners( resolve, reject ) {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// Prepares the data and sends the request.</span>
    _sendRequest() {
        <span class="hljs-comment">// Prepare form data.</span>
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> FormData();
        data.append( <span class="hljs-string">&apos;upload&apos;</span>, <span class="hljs-keyword">this</span>.loader.file );

        <span class="hljs-comment">// Send request.</span>
        <span class="hljs-keyword">this</span>.xhr.send( data );
    }
}
</code></pre>
<h3 id="activating-a-custom-upload-adapter"><a class="headerlink" href="#activating-a-custom-upload-adapter">#</a> Activating a custom upload adapter</h3>
<p>Having implemented the adapter, you must figure out how to enable it in the editor. The good news is that it is pretty easy, and you do not need to <a href="../../../builds/guides/development/custom-builds.html">rebuild the editor</a> to do that!</p>
<p>Crate a simple standalone plugin (<code>MyCustomUploadAdapterPlugin</code>) that will <a href="../../../api/module_upload_filerepository-FileRepository.html#function-createLoader">create an instance of a file loader</a> and glue it with your custom <code>MyUploadAdapter</code>.</p>
<pre class="highlight"><code class="js"><span class="hljs-keyword">import</span> ClassicEditor <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;@ckeditor/ckeditor5-build-classic&apos;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyUploadAdapter</span> </span>{
    <span class="hljs-keyword">constructor</span>( loader, url ) {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-comment">// ...</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyCustomUploadAdapterPlugin</span>(<span class="hljs-params"> editor </span>) </span>{
    editor.plugins.get( <span class="hljs-string">&apos;FileRepository&apos;</span> ).createUploadAdapter = <span class="hljs-function">(<span class="hljs-params"> loader </span>) =&gt;</span> {
        <span class="hljs-comment">// Configure the URL to the upload script in your back-end here!</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyUploadAdapter( loader, <span class="hljs-string">&apos;http://example.com/image/upload/path&apos;</span> );
    };
}
</code></pre>
<p>Enable the <code>MyCustomUploadAdapterPlugin</code> in the editor by using the <a href="../../../api/module_core_editor_editorconfig-EditorConfig.html#member-extraPlugins"><code>config.extraPlugins</code></a> option:</p>
<pre class="highlight"><code class="js">ClassicEditor
    .create( <span class="hljs-built_in">document</span>.querySelector( <span class="hljs-string">&apos;#editor&apos;</span> ), {
        <span class="hljs-attr">extraPlugins</span>: [ MyCustomUploadAdapterPlugin ],

        <span class="hljs-comment">// ...</span>
    } )
    .catch( <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log( error );
    } );
</code></pre>
<p>Run the editor and see if your implementation works. Drop an image into editor content and it should be uploaded to the server, handled by the <code>MyUploadAdapter</code>.</p>
<h2 id="whats-next"><a class="headerlink" href="#whats-next">#</a> What&#x2019;s next?</h2>
<p>Check out the <a href="../../../features/image-upload.html">comprehensive &#x201C;Image upload&#x201D; guide</a> to learn more about different ways of uploading images in CKEditor 5. See the <a href="../../../features/image.html">Image feature</a> guide to find out more about handling images in CKEditor 5.</p>

        </div>
      </section>
      <div class="side-navigation">
        <div class="side-navigation__wrapper">
          <nav class="side-navigation__inner">
            <ul class="tree guide-tree">
                          <li>
                            <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Guides</span></div>
                            <ul class="tree__item-nested-list">
                                    <li><a href="../overview.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Overview</span></div></a></li>
                                    <li><a href="../quick-start.html">
                                        <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Quick start</span></div></a></li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Architecture</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../architecture/intro.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Introduction</span></div></a></li>
                                              <li><a href="../architecture/core-editor-architecture.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Core editor architecture</span></div></a></li>
                                              <li><a href="../architecture/editing-engine.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Editing engine</span></div></a></li>
                                              <li><a href="../architecture/ui-library.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">UI library</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Deep dive</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="clipboard.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Clipboard</span></div></a></li>
                                              <li><a href="">
                                                  <div class="tree__item__wrapper tree__item__wrapper--active"><span class="tree__item--guide tree__item__text">Custom upload adapter</span></div></a></li>
                                              <li><a href="observables.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Observables</span></div></a></li>
                                              <li><a href="schema.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Schema</span></div></a></li>
                                              <li>
                                                <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">User interface</span></div>
                                                <ul class="tree__item-nested-list">
                                                        <li><a href="ui/theme-customization.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Theme customization</span></div></a></li>
                                                        <li><a href="ui/external-ui.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Third–party UI</span></div></a></li>
                                                        <li><a href="ui/document-editor.html">
                                                            <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Document editor</span></div></a></li>
                                                </ul>
                                              </li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Contributing</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../contributing/contributing.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Contributing</span></div></a></li>
                                              <li><a href="../contributing/development-environment.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Development environment</span></div></a></li>
                                              <li><a href="../contributing/testing-environment.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Testing environment</span></div></a></li>
                                              <li><a href="../contributing/git-commit-message-convention.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Git commit message convention</span></div></a></li>
                                      </ul>
                                    </li>
                                    <li>
                                      <div class="tree__item__wrapper"><span class="tree__item--folder tree__item__text">Support</span></div>
                                      <ul class="tree__item-nested-list">
                                              <li><a href="../support/browser-compatibility.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Browser compatibility</span></div></a></li>
                                              <li><a href="../support/license-and-legal.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">License and legal</span></div></a></li>
                                              <li><a href="../support/getting-support.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Getting support</span></div></a></li>
                                              <li><a href="../support/reporting-issues.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Reporting issues</span></div></a></li>
                                              <li><a href="../support/error-codes.html">
                                                  <div class="tree__item__wrapper"><span class="tree__item--guide tree__item__text">Error codes</span></div></a></li>
                                      </ul>
                                    </li>
                            </ul>
                          </li>
            </ul>
          </nav>
        </div>
      </div>
    </main>
    <footer class="footer footer--bordered">
      <p>&copy; 2017-2018 <a href="http://cksource.com">CKSource</a>. All rights reserved.</p>
    </footer>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><script type="text/javascript">
docsearch({
apiKey:'fc463c26455365ad403d5ec51796cd73',indexName:'ckeditor_nightly',inputSelector:'#docsearch_input',algoliaOptions:{hitsPerPage:250,attributesToRetrieve:'*',facetFilters:['tags: ckeditor5']},debug:true,
transformData: function( hits ) {var sortingFn = function( a, b ) {a.custom_ranking = a.custom_ranking || 0;b.custom_ranking = b.custom_ranking || 0;if ( a.custom_ranking === b.custom_ranking ) return a.index - b.index;if ( a.custom_ranking > b.custom_ranking ) return -1;if ( a.custom_ranking < b.custom_ranking ) return 1;};var result = [];var tags = [ 'builds', 'framework', 'examples', 'features', 'api' ];var hitsGrouped = { api: [] };hitsGrouped[ 'framework' ] = hits.filter( function( h ) {return h.tags.includes( 'framework' );} ).slice( 0, 7 ).map( function( item, idx ) {item.index = idx;return item;} ).sort( sortingFn );tags.forEach( function( tag ) {if ( tag !== 'framework' ) {hitsGrouped[ tag ] = hits.filter( function( h ) {return h.tags.includes( tag );} ).slice( 0, 10 ).map( function( item, idx ) {item.index = idx;return item;} ).sort( sortingFn ).slice( 0, 3 );}} );var apiSearchHits = [];if ( window.apiSearch ) apiSearchHits = window.apiSearch();hitsGrouped.api = hitsGrouped.api.filter( function( h ) {var isDuplicated = false;for ( var i = 0; i < apiSearchHits.length; i++ ) {if ( h.url.includes( apiSearchHits[ i ].urlShort ) ) {isDuplicated = true;break;}}return !isDuplicated;} );hitsGrouped.api = ( apiSearchHits || [] ).concat( hitsGrouped.api );result = result.concat( hitsGrouped[ 'framework' ] );tags.forEach( function( tag ) {if ( tag !== 'framework' ) result = result.concat( hitsGrouped[ tag ].slice( 0, 4 ) );} );return result;}
});
</script>
  </body>
</html>